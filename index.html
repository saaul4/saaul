<!DOCTYPE html>
<!-- saved from url=(0065)file:///C:/Users/Saaul/Downloads/LaPancita_SistemaDeVentas_4.html -->
<html lang="es"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>La Pancita - Sistema de Ventas</title>
<link href="./Sistema de Ventas-La pancita_files/css2" rel="stylesheet">
<script src="./Sistema de Ventas-La pancita_files/chart.umd.min.js.descarga"></script>
<style>
:root {
  --bg: #f5f0eb;
  --primary: #d9534f;
  --primary-dark: #c0392b;
  --secondary: #2d6a4f;
  --accent: #f0c040;
  --white: #ffffff;
  --text: #2c1a1a;
  --muted: #8a7070;
  --border: #e0d5cc;
  --card: #ffffff;
  --sidebar-w: 200px;
  --radius: 16px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text); display: flex; min-height: 100vh; }

/* ---- SIDEBAR ---- */
#sidebar {
  width: var(--sidebar-w); min-height: 100vh; background: var(--white);
  border-right: 1px solid var(--border); display: flex; flex-direction: column;
  position: fixed; top: 0; left: 0; bottom: 0; z-index: 100; padding: 20px 12px;
}
.brand { display: flex; align-items: center; gap: 10px; margin-bottom: 28px; padding: 0 6px; }
.brand-icon { width: 38px; height: 38px; background: var(--primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; flex-shrink: 0; }
.brand-name { font-family: 'Young Serif', serif; font-size: 15px; line-height: 1.2; color: var(--text); }
.brand-sub { font-size: 10px; color: var(--muted); }
nav { display: flex; flex-direction: column; gap: 4px; }
.nav-item {
  display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 10px;
  cursor: pointer; font-size: 14px; font-weight: 500; color: var(--muted);
  transition: all .18s; border: none; background: none; width: 100%; text-align: left;
}
.nav-item:hover { background: #f5eded; color: var(--text); }
.nav-item.active { background: var(--primary); color: white; }
.nav-item svg { width: 18px; height: 18px; flex-shrink: 0; }

/* ---- MAIN ---- */
#main { margin-left: var(--sidebar-w); flex: 1; padding: 32px 28px; min-height: 100vh; }

/* ---- PAGES ---- */
.page { display: none; }
.page.active { display: block; }

/* ---- CARDS ---- */
.card { background: var(--card); border-radius: var(--radius); padding: 20px; border: 1px solid var(--border); }
.card-sm { background: var(--card); border-radius: var(--radius); padding: 18px 20px; border: 1px solid var(--border); }

/* ---- STAT GRID ---- */
.stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 20px; }
.stat-card { background: var(--card); border-radius: var(--radius); padding: 18px 20px; border: 1px solid var(--border); position: relative; overflow: hidden; }
.stat-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; font-size: 17px; }
.stat-value { font-family: 'Young Serif', serif; font-size: 22px; color: var(--text); margin-bottom: 2px; }
.stat-label { font-size: 12px; color: var(--muted); }

/* ---- PAGE HEADER ---- */
.page-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 24px; }
.page-title { font-family: 'Young Serif', serif; font-size: 28px; }
.page-sub { font-size: 13px; color: var(--muted); margin-top: 2px; }

/* ---- BUTTONS ---- */
.btn { display: inline-flex; align-items: center; gap: 6px; padding: 10px 18px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; border: none; transition: all .15s; font-family: 'Outfit', sans-serif; }
.btn-primary { background: var(--primary); color: white; }
.btn-primary:hover { background: var(--primary-dark); }
.btn-secondary { background: var(--secondary); color: white; }
.btn-outline { background: transparent; color: var(--text); border: 1px solid var(--border); }
.btn-outline:hover { background: #f5eded; }
.btn-danger { background: transparent; color: var(--primary); border: 1px solid var(--primary); }
.btn-danger:hover { background: var(--primary); color: white; }
.btn-sm { padding: 7px 13px; font-size: 13px; }

/* ---- INPUT ---- */
.input { width: 100%; padding: 10px 14px; border-radius: 10px; border: 1px solid var(--border); font-family: 'Outfit', sans-serif; font-size: 14px; outline: none; background: var(--bg); transition: border .15s; }
.input:focus { border-color: var(--primary); }
.search-wrap { position: relative; }
.search-wrap svg { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--muted); width: 16px; height: 16px; }
.search-wrap .input { padding-left: 36px; }

/* ---- TABLE ---- */
.table-wrap { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; font-size: 14px; }
th { text-align: left; padding: 12px 16px; color: var(--muted); font-weight: 500; font-size: 13px; border-bottom: 1px solid var(--border); }
td { padding: 13px 16px; border-bottom: 1px solid var(--border); }
tr:last-child td { border-bottom: none; }
tr:hover td { background: #faf7f5; }

/* ---- BADGE ---- */
.badge { display: inline-flex; padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
.badge-green { background: #d4f4e6; color: #1a7a4a; }
.badge-red { background: #fde8e8; color: #c0392b; }
.badge-yellow { background: #fef8e1; color: #a0800a; }
.badge-blue { background: #e8f0fe; color: #2d5fa0; }

/* ---- POS ---- */
#pos-layout { display: grid; grid-template-columns: 1fr 340px; gap: 20px; height: calc(100vh - 64px); }
#pos-products { overflow-y: auto; padding-right: 4px; }
#pos-cart { background: var(--white); border-radius: var(--radius); border: 1px solid var(--border); display: flex; flex-direction: column; height: 100%; overflow: hidden; }
.pos-search { margin-bottom: 14px; }
.cat-tabs { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
.cat-tab { padding: 7px 16px; border-radius: 20px; border: none; cursor: pointer; font-size: 13px; font-weight: 600; background: var(--white); color: var(--muted); border: 1px solid var(--border); transition: all .15s; font-family: 'Outfit', sans-serif; }
.cat-tab.active { background: var(--primary); color: white; border-color: var(--primary); }
.products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; }
.product-card { background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; cursor: pointer; transition: all .15s; }
.product-card:hover { border-color: var(--primary); box-shadow: 0 4px 16px rgba(217,83,79,.12); transform: translateY(-1px); }
.product-cat-label { font-size: 10px; color: var(--muted); font-weight: 500; text-transform: uppercase; letter-spacing: .5px; margin-bottom: 4px; }
.product-name { font-size: 14px; font-weight: 600; margin-bottom: 6px; }
.product-price { font-family: 'Young Serif', serif; font-size: 15px; color: var(--primary); }
/* Cart */
.cart-header { padding: 14px 16px; border-bottom: 1px solid var(--border); }
.cart-client-input { width: 100%; padding: 9px 12px; border-radius: 10px; border: 1px solid var(--border); font-family: 'Outfit', sans-serif; font-size: 14px; outline: none; display: flex; align-items: center; gap: 8px; background: var(--bg); }
.cart-client-input:focus { border-color: var(--primary); }
.cart-items { flex: 1; overflow-y: auto; padding: 10px 14px; }
.cart-empty { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: var(--muted); font-size: 14px; gap: 10px; }
.cart-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border); }
.cart-item:last-child { border-bottom: none; }
.cart-item-info { flex: 1; }
.cart-item-name { font-size: 13px; font-weight: 600; }
.cart-item-cat { font-size: 11px; color: var(--muted); }
.cart-item-price { font-size: 13px; color: var(--primary); font-weight: 600; }
.qty-ctrl { display: flex; align-items: center; gap: 8px; }
.qty-btn { width: 24px; height: 24px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg); cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; transition: all .12s; }
.qty-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }
.qty-num { font-size: 14px; font-weight: 600; min-width: 20px; text-align: center; }
.cart-footer { padding: 14px 16px; border-top: 1px solid var(--border); }
.cart-row { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 8px; }
.cart-total { font-family: 'Young Serif', serif; font-size: 18px; color: var(--primary); font-weight: 400; }
.cart-label { font-weight: 500; }
.discount-input { width: 90px; padding: 5px 8px; border-radius: 8px; border: 1px solid var(--border); font-family: 'Outfit', sans-serif; font-size: 14px; text-align: right; outline: none; background: var(--bg); }
.pay-methods { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; margin: 12px 0; }
.pay-method { padding: 10px 6px; border-radius: 10px; border: 1.5px solid var(--border); background: var(--bg); cursor: pointer; text-align: center; font-size: 12px; font-weight: 600; transition: all .15s; font-family: 'Outfit', sans-serif; }
.pay-method.active { border-color: var(--primary); background: #fde8e8; color: var(--primary); }
.pay-method svg { display: block; margin: 0 auto 4px; width: 20px; height: 20px; }
.pago-con-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
.pago-con-input { width: 100px; padding: 6px 10px; border-radius: 8px; border: 1px solid var(--border); font-family: 'Outfit', sans-serif; font-size: 14px; text-align: right; outline: none; background: var(--bg); }
.btn-confirm { width: 100%; padding: 14px; border-radius: 12px; background: var(--primary); color: white; border: none; font-family: 'Young Serif', serif; font-size: 16px; cursor: pointer; transition: all .15s; display: flex; align-items: center; justify-content: center; gap: 8px; }
.btn-confirm:hover { background: var(--primary-dark); }
.btn-confirm:disabled { opacity: .5; cursor: not-allowed; }
.cart-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }

/* ---- MODALS ---- */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.45); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 20px; opacity: 0; pointer-events: none; transition: opacity .2s; }
.modal-overlay.open { opacity: 1; pointer-events: all; }
.modal { background: var(--white); border-radius: 20px; padding: 28px; width: 100%; max-width: 420px; transform: translateY(20px); transition: transform .2s; box-shadow: 0 20px 60px rgba(0,0,0,.15); }
.modal-overlay.open .modal { transform: translateY(0); }
.modal-title { font-family: 'Young Serif', serif; font-size: 20px; margin-bottom: 6px; }
.modal-sub { font-size: 13px; color: var(--muted); margin-bottom: 20px; }
.form-group { margin-bottom: 14px; }
.form-label { font-size: 13px; font-weight: 600; color: var(--muted); margin-bottom: 5px; display: block; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.modal-actions { display: flex; gap: 10px; margin-top: 20px; }
.modal-actions .btn { flex: 1; justify-content: center; }

/* ---- TOAST ---- */
.toast-wrap { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; }
.toast { background: var(--text); color: white; padding: 14px 18px; border-radius: 12px; font-size: 14px; font-weight: 500; min-width: 260px; display: flex; align-items: center; gap: 10px; box-shadow: 0 8px 30px rgba(0,0,0,.2); animation: slideIn .25s ease; }
.toast.success { background: var(--secondary); }
.toast.error { background: var(--primary-dark); }
@keyframes slideIn { from { transform: translateX(100px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

/* ---- TICKET MODAL ---- */
.ticket { font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6; background: #fff; border: 1px dashed #ccc; border-radius: 8px; padding: 18px; margin: 12px 0; }
.ticket-center { text-align: center; }
.ticket-divider { border: none; border-top: 1px dashed #ccc; margin: 8px 0; }
.ticket-row { display: flex; justify-content: space-between; }

/* ---- CLIENT NAME MODAL ---- */
.cn-modal { max-width: 380px; text-align: center; }
.cn-icon { font-size: 36px; margin-bottom: 10px; }
.cn-title { font-family: 'Young Serif', serif; font-size: 18px; margin-bottom: 6px; color: var(--text); }
.cn-sub { font-size: 13px; color: var(--muted); margin-bottom: 18px; }

/* ---- WEEK CHART ---- */
.charts-row { display: grid; grid-template-columns: 1fr 300px; gap: 20px; margin-top: 20px; }
.summary-bottom { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-top: 16px; }
.sum-card-green { background: var(--secondary); color: white; border-radius: var(--radius); padding: 18px 20px; }
.sum-card-white { background: var(--white); border-radius: var(--radius); padding: 18px 20px; border: 1px solid var(--border); }
.sum-card-red { background: var(--primary); color: white; border-radius: var(--radius); padding: 18px 20px; }
.sum-label { font-size: 11px; opacity: .8; text-transform: uppercase; letter-spacing: .5px; margin-bottom: 4px; }
.sum-value { font-family: 'Young Serif', serif; font-size: 22px; }
.sum-sub { font-size: 12px; opacity: .7; margin-top: 2px; }

/* ---- HISTORIAL FILTERS ---- */
.filter-tabs { display: flex; gap: 8px; margin-bottom: 20px; }
.filter-tab { padding: 7px 18px; border-radius: 20px; border: 1.5px solid var(--border); background: var(--white); color: var(--muted); font-size: 13px; font-weight: 600; cursor: pointer; transition: all .15s; font-family: 'Outfit', sans-serif; }
.filter-tab.active { background: var(--primary); color: white; border-color: var(--primary); }

/* ---- AJUSTES ---- */
.settings-section { background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); padding: 24px; margin-bottom: 20px; }
.settings-section-title { display: flex; align-items: center; gap: 10px; font-size: 16px; font-weight: 600; margin-bottom: 16px; }
.corte-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px; }
.corte-card { border-radius: 12px; padding: 14px 16px; border: 1px solid var(--border); background: var(--bg); }
.corte-card.big { background: var(--primary); color: white; grid-column: span 1; }
.corte-label { font-size: 11px; opacity: .7; margin-bottom: 4px; }
.corte-value { font-family: 'Young Serif', serif; font-size: 20px; }
.pay-breakdown { display: grid; grid-template-columns: repeat(3,1fr); gap: 12px; }
.pay-item { background: var(--bg); border-radius: 10px; padding: 14px; border: 1px solid var(--border); }
.danger-zone { border: 1px solid #fde8e8; background: #fff8f8; }
.danger-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid #fde8e8; }
.danger-row:last-child { border-bottom: none; }
.danger-title { font-size: 14px; font-weight: 600; color: var(--primary); }
.danger-sub { font-size: 12px; color: var(--muted); margin-top: 2px; }

/* ---- CLIENTES ---- */
.client-detail { cursor: pointer; }
.client-detail:hover td { background: #fdf5f5; }

/* ---- HISTORIAL ACCORDION CARDS ---- */
.hist-card {
  background: var(--white); border: 1px solid var(--border); border-radius: var(--radius);
  margin-bottom: 12px; overflow: hidden; transition: box-shadow .15s;
}
.hist-card:hover { box-shadow: 0 4px 16px rgba(0,0,0,.07); }
.hist-card-header {
  display: flex; align-items: center; gap: 14px; padding: 16px 20px;
  cursor: pointer; user-select: none;
}
.hist-card-icon { width: 36px; height: 36px; border-radius: 10px; background: #fde8e8; display: flex; align-items: center; justify-content: center; font-size: 17px; flex-shrink: 0; }
.hist-card-folio { font-weight: 700; font-size: 15px; color: var(--text); }
.hist-card-client { font-size: 12px; color: var(--muted); display: flex; align-items: center; gap: 4px; margin-top: 2px; }
.hist-card-right { margin-left: auto; text-align: right; display: flex; align-items: center; gap: 14px; }
.hist-card-total { font-family: 'Young Serif', serif; font-size: 17px; color: var(--primary); }
.hist-card-pay { font-size: 12px; color: var(--muted); }
.hist-card-chevron { transition: transform .2s; font-size: 18px; color: var(--muted); }
.hist-card.open .hist-card-chevron { transform: rotate(180deg); }
.hist-card-body { display: none; border-top: 1px solid var(--border); padding: 16px 20px; }
.hist-card.open .hist-card-body { display: block; }
.hist-items-label { font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; margin-bottom: 10px; }
.hist-item-row { display: flex; justify-content: space-between; font-size: 14px; padding: 5px 0; border-bottom: 1px solid var(--border); }
.hist-item-row:last-child { border-bottom: none; }
.hist-totals { margin-top: 10px; padding-top: 10px; border-top: 2px solid var(--border); }
.hist-total-row { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 4px; }
.hist-total-row.main { font-family: 'Young Serif', serif; font-size: 17px; color: var(--primary); }
.hist-actions { display: flex; gap: 10px; margin-top: 14px; }
.hist-actions .btn-cobrar { flex: 1; padding: 12px; border-radius: 12px; background: var(--secondary); color: white; border: none; font-family: 'Outfit', sans-serif; font-size: 14px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all .15s; }
.hist-actions .btn-cobrar:hover { background: #1e4d38; }
.hist-actions .btn-eliminar { padding: 12px 18px; border-radius: 12px; background: transparent; color: var(--primary); border: 1.5px solid var(--primary); font-family: 'Outfit', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all .15s; }
.hist-actions .btn-eliminar:hover { background: var(--primary); color: white; }

/* Empty state */
.empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; color: var(--muted); gap: 12px; }
.empty-state svg { width: 48px; height: 48px; opacity: .4; }
.empty-state p { font-size: 15px; }

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

/* Date chip */
.date-chip { background: var(--white); border: 1px solid var(--border); border-radius: 10px; padding: 8px 14px; font-size: 13px; color: var(--muted); display: flex; align-items: center; gap: 6px; }

/* select */
select.input { appearance: none; }

@media (max-width: 900px) {
  #pos-layout { grid-template-columns: 1fr; height: auto; }
  #pos-cart { height: auto; min-height: 400px; }
  .stat-grid { grid-template-columns: repeat(2,1fr); }
  .charts-row { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<!-- SIDEBAR -->
<aside id="sidebar">
  <div class="brand">
    <div class="brand-icon">üçñ</div>
    <div>
      <div class="brand-name" id="brand-name-display">La Pancita</div>
      <div class="brand-sub">Sistema de Ventas</div>
    </div>
  </div>
  <nav>
    <button class="nav-item" onclick="goTo(&#39;resumen&#39;)" id="nav-resumen">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"></rect><rect x="14" y="3" width="7" height="7" rx="1"></rect><rect x="3" y="14" width="7" height="7" rx="1"></rect><rect x="14" y="14" width="7" height="7" rx="1"></rect></svg>
      Resumen
    </button>
    <button class="nav-item" onclick="goTo(&#39;pos&#39;)" id="nav-pos">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
      Nuevo Pedido
    </button>
    <button class="nav-item" onclick="goTo(&#39;productos&#39;)" id="nav-productos">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"></path><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
      Productos
    </button>
    <button class="nav-item" onclick="goTo(&#39;clientes&#39;)" id="nav-clientes">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
      Clientes
    </button>
    <button class="nav-item" onclick="goTo(&#39;historial&#39;)" id="nav-historial">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14,2 14,8 20,8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
      Historial
    </button>
    <button class="nav-item active" onclick="goTo(&#39;ajustes&#39;)" id="nav-ajustes">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.07 4.93A10 10 0 0 0 12 2a10 10 0 0 0-7.07 2.93M4.93 4.93A10 10 0 0 0 2 12a10 10 0 0 0 2.93 7.07M4.93 19.07A10 10 0 0 0 12 22a10 10 0 0 0 7.07-2.93M19.07 19.07A10 10 0 0 0 22 12a10 10 0 0 0-2.93-7.07"></path></svg>
      Ajustes
    </button>
  </nav>
</aside>

<!-- MAIN CONTENT -->
<main id="main">

<!-- ===== RESUMEN ===== -->
<section class="page" id="page-resumen">
  <div class="page-header">
    <div>
      <h1 class="page-title">Resumen</h1>
      <p class="page-sub">Resumen de tu negocio hoy</p>
    </div>
    <div class="date-chip">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><rect x="3" y="4" width="18" height="18" rx="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
      <span id="res-date">mi√©rcoles, 25 de febrero de 2026</span>
    </div>
  </div>
  <div class="stat-grid">
    <div class="stat-card">
      <div class="stat-icon" style="background:#fde8e8;color:var(--primary);">üí∞</div>
      <div class="stat-value" id="res-ventas-hoy">$515 MXN</div>
      <div class="stat-label">Ventas de hoy</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background:#e8f5ee;color:var(--secondary);">üßæ</div>
      <div class="stat-value" id="res-pedidos-hoy">1</div>
      <div class="stat-label">Pedidos de hoy</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background:#fef8e1;color:#a07800;">üìà</div>
      <div class="stat-value" id="res-ticket-prom">$515 MXN</div>
      <div class="stat-label">Ticket promedio</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background:#f0eafe;color:#6c3ac2;">üë•</div>
      <div class="stat-value" id="res-clientes-hoy">1</div>
      <div class="stat-label">Clientes hoy</div>
    </div>
  </div>
  <div class="charts-row">
    <div class="card">
      <h3 style="font-family:&#39;Young Serif&#39;,serif;font-size:17px;margin-bottom:16px;">Ventas de la Semana</h3>
      <div style="position:relative;height:200px;width:100%;">
        <canvas id="weekChart" width="740" height="200" style="display: block; box-sizing: border-box; height: 200px; width: 740px;"></canvas>
      </div>
    </div>
    <div class="card">
      <h3 style="font-family:&#39;Young Serif&#39;,serif;font-size:17px;margin-bottom:16px;">üèÜ Top Platillos</h3>
      <div id="top-platillos">
      <div style="display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border);">
        <div style="width:24px;height:24px;border-radius:50%;background:#d9534f;color:white;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;">1</div>
        <div style="flex:1;min-width:0;">
          <div style="font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">Pancita de Res (Grande)</div>
          <div style="font-size:11px;color:var(--muted);">1 vendido</div>
        </div>
        <div style="font-size:13px;font-weight:700;color:var(--text);white-space:nowrap;">$80 MXN</div>
      </div>
      <div style="display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border);">
        <div style="width:24px;height:24px;border-radius:50%;background:#8a7070;color:white;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;">2</div>
        <div style="flex:1;min-width:0;">
          <div style="font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">Pancita Chica</div>
          <div style="font-size:11px;color:var(--muted);">1 vendido</div>
        </div>
        <div style="font-size:13px;font-weight:700;color:var(--text);white-space:nowrap;">$50 MXN</div>
      </div>
      <div style="display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border);">
        <div style="width:24px;height:24px;border-radius:50%;background:#c0a060;color:white;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;">3</div>
        <div style="flex:1;min-width:0;">
          <div style="font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">Litro para Llevar</div>
          <div style="font-size:11px;color:var(--muted);">1 vendido</div>
        </div>
        <div style="font-size:13px;font-weight:700;color:var(--text);white-space:nowrap;">$120 MXN</div>
      </div>
      <div style="display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border);">
        <div style="width:24px;height:24px;border-radius:50%;background:#5a8a5a;color:white;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;">4</div>
        <div style="flex:1;min-width:0;">
          <div style="font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">Medio Litro para Llevar</div>
          <div style="font-size:11px;color:var(--muted);">1 vendido</div>
        </div>
        <div style="font-size:13px;font-weight:700;color:var(--text);white-space:nowrap;">$70 MXN</div>
      </div>
      <div style="display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border);">
        <div style="width:24px;height:24px;border-radius:50%;background:#5a70a0;color:white;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;">5</div>
        <div style="flex:1;min-width:0;">
          <div style="font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">Refresco</div>
          <div style="font-size:11px;color:var(--muted);">1 vendido</div>
        </div>
        <div style="font-size:13px;font-weight:700;color:var(--text);white-space:nowrap;">$20 MXN</div>
      </div></div>
    </div>
  </div>
  <div class="summary-bottom">
    <div class="sum-card-green">
      <div class="sum-label">Esta Semana</div>
      <div class="sum-value" id="res-semana">$515 MXN</div>
      <div class="sum-sub" id="res-semana-ped">1 pedidos</div>
    </div>
    <div class="sum-card-white">
      <div class="sum-label" style="color:var(--muted);">Este Mes</div>
      <div class="sum-value" id="res-mes">$515 MXN</div>
      <div class="sum-sub" style="color:var(--muted);" id="res-mes-ped">1 pedidos</div>
    </div>
    <div class="sum-card-red">
      <div class="sum-label">Platillo Estrella</div>
      <div class="sum-value" id="res-estrella">Pancita de Res (Grande)</div>
      <div class="sum-sub" id="res-estrella-sub">1 vendidos hoy</div>
    </div>
  </div>
</section>

<!-- ===== NUEVO PEDIDO (POS) ===== -->
<section class="page" id="page-pos" style="padding:0;">
  <div id="pos-layout" style="padding:28px 28px;">
    <!-- Products side -->
    <div id="pos-products">
      <div class="pos-search search-wrap" style="margin-bottom:12px;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input class="input" id="pos-search-input" placeholder="Buscar producto..." oninput="filterProducts()">
      </div>
      <div class="cat-tabs" id="cat-tabs"><button class="cat-tab active" onclick="filterCat(&#39;Todos&#39;,this)">Todos</button><button class="cat-tab" onclick="filterCat(&#39;Plato&#39;,this)">Plato</button><button class="cat-tab" onclick="filterCat(&#39;Para Llevar&#39;,this)">Para Llevar</button><button class="cat-tab" onclick="filterCat(&#39;Extra&#39;,this)">Extra</button><button class="cat-tab" onclick="filterCat(&#39;Bebida&#39;,this)">Bebida</button><button class="cat-tab" onclick="filterCat(&#39;Postre&#39;,this)">Postre</button></div>
      <div class="products-grid" id="products-grid">
    <div class="product-card" onclick="addToCart(1)">
      <div class="product-cat-label">Plato</div>
      <div class="product-name">Pancita de Res (Grande)</div>
      <div class="product-price">$80 MXN</div>
    </div>
    <div class="product-card" onclick="addToCart(2)">
      <div class="product-cat-label">Plato</div>
      <div class="product-name">Pancita Chica</div>
      <div class="product-price">$50 MXN</div>
    </div>
    <div class="product-card" onclick="addToCart(3)">
      <div class="product-cat-label">Para Llevar</div>
      <div class="product-name">Litro para Llevar</div>
      <div class="product-price">$120 MXN</div>
    </div>
    <div class="product-card" onclick="addToCart(4)">
      <div class="product-cat-label">Para Llevar</div>
      <div class="product-name">Medio Litro para Llevar</div>
      <div class="product-price">$70 MXN</div>
    </div>
    <div class="product-card" onclick="addToCart(5)">
      <div class="product-cat-label">Extra</div>
      <div class="product-name">Tortillas (3 pz)</div>
      <div class="product-price">$10 MXN</div>
    </div>
    <div class="product-card" onclick="addToCart(6)">
      <div class="product-cat-label">Bebida</div>
      <div class="product-name">Cerveza</div>
      <div class="product-price">$25 MXN</div>
    </div>
    <div class="product-card" onclick="addToCart(7)">
      <div class="product-cat-label">Extra</div>
      <div class="product-name">Chicharrones (3 pz)</div>
      <div class="product-price">$15 MXN</div>
    </div>
    <div class="product-card" onclick="addToCart(8)">
      <div class="product-cat-label">Bebida</div>
      <div class="product-name">Refresco</div>
      <div class="product-price">$20 MXN</div>
    </div>
    <div class="product-card" onclick="addToCart(9)">
      <div class="product-cat-label">Plato</div>
      <div class="product-name">Consom√©</div>
      <div class="product-price">$35 MXN</div>
    </div>
    <div class="product-card" onclick="addToCart(10)">
      <div class="product-cat-label">Bebida</div>
      <div class="product-name">Agua de Sabor</div>
      <div class="product-price">$20 MXN</div>
    </div>
    <div class="product-card" onclick="addToCart(11)">
      <div class="product-cat-label">Postre</div>
      <div class="product-name">Pastel</div>
      <div class="product-price">$70 MXN</div>
    </div></div>
    </div>
    <!-- Cart side -->
    <div id="pos-cart">
      <div class="cart-header">
        <div style="position:relative;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--muted);"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
          <input class="cart-client-input" id="cart-client" placeholder="Nombre del cliente" style="padding-left:34px;">
        </div>
      </div>
      <div class="cart-items" id="cart-items">
        <div class="cart-empty" id="cart-empty">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="40" height="40"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
          <span>Carrito vac√≠o</span>
        </div>
      </div>
      <div class="cart-footer">
        <div class="cart-row"><span class="cart-label">Subtotal</span><span id="cart-subtotal">$0 MXN</span></div>
        <div class="cart-row" style="align-items:center;"><span class="cart-label">Descuento</span><input type="number" class="discount-input" id="cart-discount" value="0" min="0" oninput="updateCartTotals()"></div>
        <div class="cart-row" style="margin-bottom:10px;border-top:1px solid var(--border);padding-top:8px;"><span class="cart-label" style="font-size:16px;font-weight:700;">Total</span><span id="cart-total" class="cart-total">$0 MXN</span></div>
        <div class="pay-methods" id="pay-methods">
          <button class="pay-method active" onclick="selectPayMethod(&#39;efectivo&#39;,this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="12" rx="2"></rect><circle cx="12" cy="12" r="2"></circle></svg>
            Efectivo
          </button>
          <button class="pay-method" onclick="selectPayMethod(&#39;tarjeta&#39;,this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
            Tarjeta
          </button>
          <button class="pay-method" onclick="selectPayMethod(&#39;transferencia&#39;,this)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="5" y="2" width="14" height="20" rx="2"></rect><line x1="12" y1="18" x2="12" y2="18"></line></svg>
            Transfer
          </button>
        </div>
        <div class="pago-con-row">
          <span style="font-size:13px;color:var(--muted);">Pago con</span>
          <input type="number" class="pago-con-input" id="pago-con" value="0" min="0">
        </div>
        <div class="cart-actions">
          <button class="btn btn-outline" onclick="clearCart()">Limpiar</button>
          <button class="btn btn-outline" onclick="saveOrder()">Guardar</button>
        </div>
        <button class="btn-confirm" id="confirm-btn" onclick="confirmOrder()">
          ‚úì Confirmar Pedido <span id="confirm-total">$0 MXN</span>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- ===== PRODUCTOS ===== -->
<section class="page" id="page-productos">
  <div class="page-header">
    <div>
      <h1 class="page-title">Productos</h1>
      <p class="page-sub" id="prod-count-label">11 productos en el men√∫</p>
    </div>
    <button class="btn btn-primary" onclick="openProductModal()">+ Agregar Producto</button>
  </div>
  <div class="card">
    <div class="search-wrap" style="margin-bottom:16px;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      <input class="input" placeholder="Buscar producto..." oninput="filterProductTable(this.value)">
    </div>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Producto</th><th>Categor√≠a</th><th>Precio</th><th>Estado</th><th>Acciones</th></tr></thead>
        <tbody id="products-table">
    <tr>
      <td style="font-weight:600;">Pancita de Res (Grande)</td>
      <td><span class="badge badge-blue">Plato</span></td>
      <td style="font-family:&#39;Young Serif&#39;,serif;color:var(--primary);">$80 MXN</td>
      <td><span class="badge badge-green">Activo</span></td>
      <td>
        <button class="btn btn-outline btn-sm" onclick="editProduct(1)" style="margin-right:6px;">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(1)">üóë</button>
      </td>
    </tr>
    <tr>
      <td style="font-weight:600;">Pancita Chica</td>
      <td><span class="badge badge-blue">Plato</span></td>
      <td style="font-family:&#39;Young Serif&#39;,serif;color:var(--primary);">$50 MXN</td>
      <td><span class="badge badge-green">Activo</span></td>
      <td>
        <button class="btn btn-outline btn-sm" onclick="editProduct(2)" style="margin-right:6px;">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(2)">üóë</button>
      </td>
    </tr>
    <tr>
      <td style="font-weight:600;">Litro para Llevar</td>
      <td><span class="badge badge-blue">Para Llevar</span></td>
      <td style="font-family:&#39;Young Serif&#39;,serif;color:var(--primary);">$120 MXN</td>
      <td><span class="badge badge-green">Activo</span></td>
      <td>
        <button class="btn btn-outline btn-sm" onclick="editProduct(3)" style="margin-right:6px;">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(3)">üóë</button>
      </td>
    </tr>
    <tr>
      <td style="font-weight:600;">Medio Litro para Llevar</td>
      <td><span class="badge badge-blue">Para Llevar</span></td>
      <td style="font-family:&#39;Young Serif&#39;,serif;color:var(--primary);">$70 MXN</td>
      <td><span class="badge badge-green">Activo</span></td>
      <td>
        <button class="btn btn-outline btn-sm" onclick="editProduct(4)" style="margin-right:6px;">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(4)">üóë</button>
      </td>
    </tr>
    <tr>
      <td style="font-weight:600;">Tortillas (3 pz)</td>
      <td><span class="badge badge-blue">Extra</span></td>
      <td style="font-family:&#39;Young Serif&#39;,serif;color:var(--primary);">$10 MXN</td>
      <td><span class="badge badge-green">Activo</span></td>
      <td>
        <button class="btn btn-outline btn-sm" onclick="editProduct(5)" style="margin-right:6px;">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(5)">üóë</button>
      </td>
    </tr>
    <tr>
      <td style="font-weight:600;">Cerveza</td>
      <td><span class="badge badge-blue">Bebida</span></td>
      <td style="font-family:&#39;Young Serif&#39;,serif;color:var(--primary);">$25 MXN</td>
      <td><span class="badge badge-green">Activo</span></td>
      <td>
        <button class="btn btn-outline btn-sm" onclick="editProduct(6)" style="margin-right:6px;">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(6)">üóë</button>
      </td>
    </tr>
    <tr>
      <td style="font-weight:600;">Chicharrones (3 pz)</td>
      <td><span class="badge badge-blue">Extra</span></td>
      <td style="font-family:&#39;Young Serif&#39;,serif;color:var(--primary);">$15 MXN</td>
      <td><span class="badge badge-green">Activo</span></td>
      <td>
        <button class="btn btn-outline btn-sm" onclick="editProduct(7)" style="margin-right:6px;">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(7)">üóë</button>
      </td>
    </tr>
    <tr>
      <td style="font-weight:600;">Refresco</td>
      <td><span class="badge badge-blue">Bebida</span></td>
      <td style="font-family:&#39;Young Serif&#39;,serif;color:var(--primary);">$20 MXN</td>
      <td><span class="badge badge-green">Activo</span></td>
      <td>
        <button class="btn btn-outline btn-sm" onclick="editProduct(8)" style="margin-right:6px;">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(8)">üóë</button>
      </td>
    </tr>
    <tr>
      <td style="font-weight:600;">Consom√©</td>
      <td><span class="badge badge-blue">Plato</span></td>
      <td style="font-family:&#39;Young Serif&#39;,serif;color:var(--primary);">$35 MXN</td>
      <td><span class="badge badge-green">Activo</span></td>
      <td>
        <button class="btn btn-outline btn-sm" onclick="editProduct(9)" style="margin-right:6px;">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(9)">üóë</button>
      </td>
    </tr>
    <tr>
      <td style="font-weight:600;">Agua de Sabor</td>
      <td><span class="badge badge-blue">Bebida</span></td>
      <td style="font-family:&#39;Young Serif&#39;,serif;color:var(--primary);">$20 MXN</td>
      <td><span class="badge badge-green">Activo</span></td>
      <td>
        <button class="btn btn-outline btn-sm" onclick="editProduct(10)" style="margin-right:6px;">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(10)">üóë</button>
      </td>
    </tr>
    <tr>
      <td style="font-weight:600;">Pastel</td>
      <td><span class="badge badge-blue">Postre</span></td>
      <td style="font-family:&#39;Young Serif&#39;,serif;color:var(--primary);">$70 MXN</td>
      <td><span class="badge badge-green">Activo</span></td>
      <td>
        <button class="btn btn-outline btn-sm" onclick="editProduct(11)" style="margin-right:6px;">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(11)">üóë</button>
      </td>
    </tr></tbody>
      </table>
      <div class="empty-state" id="prod-empty" style="display:none;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"></path><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
        <p>No hay productos. ¬°Agrega uno!</p>
      </div>
    </div>
  </div>
</section>

<!-- ===== CLIENTES ===== -->
<section class="page" id="page-clientes">
  <div class="page-header">
    <div>
      <h1 class="page-title">Clientes</h1>
      <p class="page-sub" id="client-count-label">1 clientes registrados</p>
    </div>
    <button class="btn btn-primary" onclick="openClientModal()">+ Nuevo Cliente</button>
  </div>
  <div class="stat-grid" style="margin-bottom:20px;">
    <div class="stat-card"><div class="stat-value" id="cl-total">1</div><div class="stat-label">Total Clientes</div></div>
    <div class="stat-card"><div class="stat-value" id="cl-frecuentes">0</div><div class="stat-label">Clientes Frecuentes</div></div>
    <div class="stat-card"><div class="stat-value" id="cl-visitas">1</div><div class="stat-label">M√°x. Visitas</div></div>
    <div class="stat-card"><div class="stat-value" id="cl-gastado">$515 MXN</div><div class="stat-label">Total Gastado</div></div>
  </div>
  <div class="card">
    <div class="search-wrap" style="margin-bottom:16px;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      <input class="input" placeholder="Buscar cliente..." oninput="filterClients(this.value)">
    </div>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Nombre</th><th>Visitas</th><th>√öltimo pedido</th><th>Total gastado</th></tr></thead>
        <tbody id="clients-table">
    <tr>
      <td style="font-weight:600;">saul</td>
      <td>1</td>
      <td>2026-02-26</td>
      <td style="font-family:&#39;Young Serif&#39;,serif;color:var(--primary);">$515 MXN</td>
    </tr></tbody>
      </table>
      <div class="empty-state" id="cl-empty" style="display: none;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
        <p>No se encontraron clientes</p>
      </div>
    </div>
  </div>
</section>

<!-- ===== HISTORIAL ===== -->
<section class="page" id="page-historial">
  <div class="page-header">
    <div>
      <h1 class="page-title">Historial de Pedidos</h1>
      <p class="page-sub" id="hist-count-label">1 pedidos registrados</p>
    </div>
  </div>
  <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px;flex-wrap:wrap;">
    <div class="search-wrap" style="flex:1;min-width:200px;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      <input class="input" placeholder="Buscar por cliente o folio..." oninput="filterHistorial(this.value)">
    </div>
    <div class="filter-tabs">
      <button class="filter-tab active" onclick="setHistFilter(&#39;todos&#39;,this)">Todos</button>
      <button class="filter-tab" onclick="setHistFilter(&#39;pagado&#39;,this)">Pagado</button>
      <button class="filter-tab" onclick="setHistFilter(&#39;consumiendo&#39;,this)">Consumiendo</button>
      <button class="filter-tab" onclick="setHistFilter(&#39;cancelado&#39;,this)">Cancelado</button>
    </div>
  </div>
  <div id="historial-cards">
    <div class="hist-card" id="hcard-1">
      <div class="hist-card-header" onclick="toggleHistCard(1)">
        <div class="hist-card-icon">üßæ</div>
        <div>
          <div style="display:flex;align-items:center;gap:8px;">
            <span class="hist-card-folio">#0001</span>
            <span class="badge badge-green">Pagado</span>
          </div>
          <div class="hist-card-client">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
            saul
            <span style="margin-left:6px;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><rect x="3" y="4" width="18" height="18" rx="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            </span>
            2026-02-26, 09:25 p.m.
          </div>
        </div>
        <div class="hist-card-right">
          <div>
            <div class="hist-card-total">$515 MXN</div>
            <div class="hist-card-pay">Efectivo</div>
          </div>
          <span class="hist-card-chevron">‚ñæ</span>
        </div>
      </div>
      <div class="hist-card-body">
        <div class="hist-items-label">Productos</div>
        
          <div class="hist-item-row">
            <span>Pancita de Res (Grande) x1</span>
            <span>$80 MXN</span>
          </div>
          <div class="hist-item-row">
            <span>Pancita Chica x1</span>
            <span>$50 MXN</span>
          </div>
          <div class="hist-item-row">
            <span>Litro para Llevar x1</span>
            <span>$120 MXN</span>
          </div>
          <div class="hist-item-row">
            <span>Medio Litro para Llevar x1</span>
            <span>$70 MXN</span>
          </div>
          <div class="hist-item-row">
            <span>Refresco x1</span>
            <span>$20 MXN</span>
          </div>
          <div class="hist-item-row">
            <span>Chicharrones (3 pz) x1</span>
            <span>$15 MXN</span>
          </div>
          <div class="hist-item-row">
            <span>Cerveza x1</span>
            <span>$25 MXN</span>
          </div>
          <div class="hist-item-row">
            <span>Tortillas (3 pz) x1</span>
            <span>$10 MXN</span>
          </div>
          <div class="hist-item-row">
            <span>Consom√© x1</span>
            <span>$35 MXN</span>
          </div>
          <div class="hist-item-row">
            <span>Agua de Sabor x1</span>
            <span>$20 MXN</span>
          </div>
          <div class="hist-item-row">
            <span>Pastel x1</span>
            <span>$70 MXN</span>
          </div>
        <div class="hist-totals">
          <div class="hist-total-row"><span>Subtotal</span><span>$515 MXN</span></div>
          
          <div class="hist-total-row main"><span>Total</span><span>$515 MXN</span></div>
        </div>
        
        <div class="hist-actions">
          <button class="btn-cobrar" onclick="showTicketById(1)">üßæ Ver Ticket</button>
          <button class="btn-eliminar" onclick="eliminarPedido(1)">üóë Eliminar</button>
        </div>
      </div>
    </div></div>
  <div class="empty-state" id="hist-empty" style="display:none;">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14,2 14,8 20,8"></polyline></svg>
    <p>No se encontraron ventas</p>
  </div>
</section>

<!-- ===== AJUSTES ===== -->
<section class="page active" id="page-ajustes">
  <div class="page-header">
    <div>
      <h1 class="page-title">Ajustes</h1>
      <p class="page-sub">Configuraci√≥n y corte de caja</p>
    </div>
  </div>
  <!-- Nombre negocio -->
  <div class="settings-section">
    <div class="settings-section-title"><span>üè™</span> Nombre del Negocio</div>
    <div style="display:flex;gap:12px;">
      <input class="input" id="settings-nombre" value="La Pancita" style="flex:1;">
      <button class="btn btn-secondary" onclick="saveBusinessName()">üíæ Guardar</button>
    </div>
  </div>
  <!-- Corte de Caja -->
  <div class="settings-section">
    <div class="settings-section-title"><span>üßÆ</span> Corte de Caja</div>
    <div class="corte-grid">
      <div class="corte-card big">
        <div class="corte-label">Total del D√≠a</div>
        <div class="corte-value" id="corte-total">$515 MXN</div>
      </div>
      <div class="corte-card">
        <div class="corte-label">üßæ Tickets</div>
        <div class="corte-value" id="corte-tickets">1</div>
      </div>
      <div class="corte-card">
        <div class="corte-label">$ Promedio</div>
        <div class="corte-value" id="corte-prom">$515 MXN</div>
      </div>
    </div>
    <p style="font-size:13px;font-weight:600;color:var(--muted);margin-bottom:12px;">Desglose por M√©todo de Pago</p>
    <div class="pay-breakdown">
      <div class="pay-item"><div style="font-size:12px;color:var(--muted);margin-bottom:4px;">üíµ Efectivo</div><div style="font-family:&#39;Young Serif&#39;,serif;font-size:18px;" id="corte-efectivo">$515 MXN</div></div>
      <div class="pay-item"><div style="font-size:12px;color:var(--muted);margin-bottom:4px;">üí≥ Tarjeta</div><div style="font-family:&#39;Young Serif&#39;,serif;font-size:18px;" id="corte-tarjeta">$0 MXN</div></div>
      <div class="pay-item"><div style="font-size:12px;color:var(--muted);margin-bottom:4px;">üì± Transferencia</div><div style="font-family:&#39;Young Serif&#39;,serif;font-size:18px;" id="corte-transfer">$0 MXN</div></div>
    </div>
    <div id="corte-corriente" style="margin-top: 14px; padding: 12px 16px; background: rgb(232, 245, 238); border-radius: 10px; color: rgb(45, 106, 79); font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px;">‚úÖ Todo al Corriente ‚Äî Todas las cuentas han sido cobradas</div>
    <button class="btn btn-outline btn-sm" style="margin-top:14px;" onclick="refreshCorte()">üîÑ Actualizar</button>
  </div>
  <!-- Danger Zone -->
  <div class="settings-section danger-zone">
    <div class="settings-section-title" style="color:var(--primary);"><span>‚ö†Ô∏è</span> Zona de Peligro ‚Äî Acciones irreversibles</div>
    <div class="danger-row">
      <div>
        <div class="danger-title">Eliminar Historial</div>
        <div class="danger-sub">Borra todas las ventas y clientes. Los productos se mantienen.</div>
      </div>
      <button class="btn btn-danger btn-sm" onclick="confirmDanger(&#39;historial&#39;)">üóë Eliminar Historial</button>
    </div>
    <div class="danger-row">
      <div>
        <div class="danger-title">Reiniciar Sistema Completo</div>
        <div class="danger-sub">Elimina ABSOLUTAMENTE TODO. El sistema quedar√° como nuevo.</div>
      </div>
      <button class="btn btn-primary btn-sm" style="background:var(--primary-dark);" onclick="confirmDanger(&#39;todo&#39;)">üóë Reiniciar Todo</button>
    </div>
  </div>
  <!-- Acerca de -->
  <div class="settings-section">
    <div class="settings-section-title">üìã Acerca de</div>
    <p style="font-size:14px;"><strong id="about-name">La Pancita</strong> ‚Äî Sistema de Punto de Venta</p>
    <p style="font-size:13px;color:var(--muted);margin-top:4px;">Versi√≥n 2.0 Web ¬∑ Desarrollado con ‚ù§Ô∏è para tu negocio</p>
  </div>
</section>

</main>

<!-- ===== MODALS ===== -->

<!-- Product Modal -->
<div class="modal-overlay" id="modal-product">
  <div class="modal">
    <h2 class="modal-title" id="modal-prod-title">Agregar Producto</h2>
    <p class="modal-sub">Completa los datos del platillo</p>
    <input type="hidden" id="edit-prod-id">
    <div class="form-group">
      <label class="form-label">Nombre del platillo *</label>
      <input class="input" id="prod-name" placeholder="Ej: Pancita de Res">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Precio (MXN) *</label>
        <input type="number" class="input" id="prod-price" placeholder="0" min="0">
      </div>
      <div class="form-group">
        <label class="form-label">Categor√≠a *</label>
        <select class="input" id="prod-cat">
          <option value="Plato">Plato</option>
          <option value="Para Llevar">Para Llevar</option>
          <option value="Extra">Extra</option>
          <option value="Bebida">Bebida</option>
          <option value="Postre">Postre</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Estado</label>
      <select class="input" id="prod-status">
        <option value="activo">Activo</option>
        <option value="inactivo">Inactivo</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal(&#39;modal-product&#39;)">Cancelar</button>
      <button class="btn btn-primary" onclick="saveProduct()">Guardar Producto</button>
    </div>
  </div>
</div>

<!-- Client Modal -->
<div class="modal-overlay" id="modal-client">
  <div class="modal">
    <h2 class="modal-title">Nuevo Cliente</h2>
    <p class="modal-sub">Registra un cliente frecuente</p>
    <div class="form-group">
      <label class="form-label">Nombre *</label>
      <input class="input" id="cl-name" placeholder="Nombre completo">
    </div>
    <div class="form-group">
      <label class="form-label">Tel√©fono (opcional)</label>
      <input class="input" id="cl-phone" placeholder="555-123-4567">
    </div>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal(&#39;modal-client&#39;)">Cancelar</button>
      <button class="btn btn-primary" onclick="saveClient()">Guardar Cliente</button>
    </div>
  </div>
</div>

<!-- Client Name Modal (when confirming order without name) -->
<div class="modal-overlay" id="modal-client-name">
  <div class="modal cn-modal">
    <div class="cn-icon">‚ö†Ô∏è</div>
    <div class="cn-title">¬øSin nombre de cliente?</div>
    <div class="cn-sub">Escribe el nombre o contin√∫a sin √©l</div>
    <input class="input" id="cn-input" placeholder="Nombre del cliente..." style="margin-bottom:16px;">
    <div style="display:flex;gap:10px;">
      <button class="btn btn-outline" style="flex:1;" onclick="proceedOrder(false)">Continuar sin nombre</button>
      <button class="btn btn-primary" style="flex:1;" onclick="proceedOrder(true)">‚úì Confirmar con nombre</button>
    </div>
  </div>
</div>

<!-- Ticket Modal -->
<div class="modal-overlay" id="modal-ticket">
  <div class="modal" style="max-width:380px;">
    <h2 class="modal-title" style="text-align:center;">üßæ Ticket</h2>
    <div id="ticket-content"></div>
    <div style="display:flex;gap:10px;margin-top:16px;">
      <button class="btn btn-outline" style="flex:1;" onclick="closeModal(&#39;modal-ticket&#39;)">Cerrar</button>
      <button class="btn btn-primary" style="flex:1;" onclick="printTicket()">üñ®Ô∏è Imprimir</button>
    </div>
  </div>
</div>

<!-- Order Detail Modal -->
<div class="modal-overlay" id="modal-order">
  <div class="modal" style="max-width:440px;">
    <h2 class="modal-title">Detalle del Pedido</h2>
    <div id="order-detail-content"></div>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal(&#39;modal-order&#39;)">Cerrar</button>
      <button class="btn btn-danger btn-sm" id="cancel-order-btn" onclick="cancelCurrentOrder()">Cancelar Pedido</button>
    </div>
  </div>
</div>

<!-- Danger Confirm Modal -->
<div class="modal-overlay" id="modal-danger">
  <div class="modal" style="max-width:360px;text-align:center;">
    <div style="font-size:40px;margin-bottom:12px;">‚ö†Ô∏è</div>
    <h2 class="modal-title" id="danger-title">¬øEst√°s seguro?</h2>
    <p class="modal-sub" id="danger-sub">Esta acci√≥n no se puede deshacer.</p>
    <div style="display:flex;gap:10px;margin-top:20px;">
      <button class="btn btn-outline" style="flex:1;" onclick="closeModal(&#39;modal-danger&#39;)">Cancelar</button>
      <button class="btn btn-primary" style="flex:1;background:var(--primary-dark);" id="danger-confirm-btn" onclick="executeDanger()">Confirmar</button>
    </div>
  </div>
</div>

<!-- Toast container -->
<div class="toast-wrap" id="toasts"></div>

<script>
// ========== STATE ==========
let state = JSON.parse(localStorage.getItem('lapancita_state') || 'null') || {
  businessName: 'La Pancita',
  products: [
    {id:1,name:'Pancita de Res (Grande)',price:80,cat:'Plato',status:'activo'},
    {id:2,name:'Pancita Chica',price:50,cat:'Plato',status:'activo'},
    {id:3,name:'Litro para Llevar',price:120,cat:'Para Llevar',status:'activo'},
    {id:4,name:'Medio Litro para Llevar',price:70,cat:'Para Llevar',status:'activo'},
    {id:5,name:'Tortillas (3 pz)',price:10,cat:'Extra',status:'activo'},
    {id:6,name:'Cerveza',price:25,cat:'Bebida',status:'activo'},
    {id:7,name:'Chicharrones (3 pz)',price:15,cat:'Extra',status:'activo'},
    {id:8,name:'Refresco',price:20,cat:'Bebida',status:'activo'},
    {id:9,name:'Consom√©',price:35,cat:'Plato',status:'activo'},
    {id:10,name:'Agua de Sabor',price:20,cat:'Bebida',status:'activo'},
    {id:11,name:'Pastel',price:70,cat:'Postre',status:'activo'},
  ],
  orders: [],
  clients: [],
  nextOrderId: 1,
  nextProductId: 12,
  nextClientId: 1,
};

let cart = [];
let selectedPayMethod = 'efectivo';
let histFilter = 'todos';
let histSearch = '';
let viewingOrderId = null;
let dangerAction = null;
let weekChartInstance = null;

// ========== SAVE STATE ==========
function saveState() {
  localStorage.setItem('lapancita_state', JSON.stringify(state));
}

// ========== NAVIGATION ==========
function goTo(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.getElementById('nav-' + page).classList.add('active');
  if (page === 'resumen') renderResumen();
  if (page === 'pos') renderPOS();
  if (page === 'productos') renderProductos();
  if (page === 'clientes') renderClientes();
  if (page === 'historial') renderHistorial();
  if (page === 'ajustes') renderAjustes();
}

// ========== TOAST ==========
function toast(msg, type='success') {
  const t = document.createElement('div');
  t.className = 'toast ' + type;
  t.innerHTML = (type==='success'?'‚úÖ':'‚ùå') + ' ' + msg;
  document.getElementById('toasts').appendChild(t);
  setTimeout(() => t.remove(), 3000);
}

// ========== MODALS ==========
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }

// ========== FORMAT ==========
function fmt(n) { return '$' + Number(n).toLocaleString('es-MX', {minimumFractionDigits:0,maximumFractionDigits:0}) + ' MXN'; }
function today() { return new Date().toISOString().split('T')[0]; }
function todayStr() {
  const d = new Date();
  const days = ['domingo','lunes','martes','mi√©rcoles','jueves','viernes','s√°bado'];
  const months = ['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre'];
  return days[d.getDay()] + ', ' + d.getDate() + ' de ' + months[d.getMonth()] + ' de ' + d.getFullYear();
}

// ========== RESUMEN ==========
function renderResumen() {
  document.getElementById('res-date').textContent = todayStr();
  const todayOrders = state.orders.filter(o => o.date === today() && o.status !== 'cancelado');
  const totalHoy = todayOrders.reduce((s,o) => s+o.total, 0);
  const ticketProm = todayOrders.length ? Math.round(totalHoy/todayOrders.length) : 0;
  const clientesHoy = new Set(todayOrders.filter(o=>o.client).map(o=>o.client)).size;
  document.getElementById('res-ventas-hoy').textContent = fmt(totalHoy);
  document.getElementById('res-pedidos-hoy').textContent = todayOrders.length;
  document.getElementById('res-ticket-prom').textContent = fmt(ticketProm);
  document.getElementById('res-clientes-hoy').textContent = clientesHoy;

  // Week chart - √∫ltimos 7 d√≠as
  const now = new Date();
  const dayNames = ['Dom','Lun','Mar','Mi√©','Jue','Vie','S√°b'];
  const last7labels = [];
  const last7data = [];
  for (let i = 6; i >= 0; i--) {
    const d = new Date(now);
    d.setDate(d.getDate() - i);
    const ds = d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
    last7labels.push(dayNames[d.getDay()]);
    last7data.push(state.orders.filter(o => o.date === ds && o.status !== 'cancelado').reduce((s,o) => s + o.total, 0));
  }

  const canvas = document.getElementById('weekChart');
  if (weekChartInstance) weekChartInstance.destroy();
  weekChartInstance = new Chart(canvas, {
    type: 'bar',
    data: {
      labels: last7labels,
      datasets: [{
        data: last7data,
        backgroundColor: last7labels.map((_,i) => i === 6 ? '#d9534f' : '#f0b8b7'),
        borderRadius: 8,
        borderSkipped: false
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: true, ticks: { callback: v => '$' + v.toLocaleString('es-MX') }, grid: { color: '#f0ebe5' } },
        x: { grid: { display: false } }
      },
      responsive: true,
      maintainAspectRatio: false
    }
  });

  // This week
  const monday = new Date(now); monday.setDate(now.getDate() - now.getDay() + (now.getDay()===0?-6:1));
  const mondayStr = monday.getFullYear() + '-' + String(monday.getMonth()+1).padStart(2,'0') + '-' + String(monday.getDate()).padStart(2,'0');
  const weekOrders = state.orders.filter(o => o.status !== 'cancelado' && o.date >= mondayStr);
  document.getElementById('res-semana').textContent = fmt(weekOrders.reduce((s,o)=>s+o.total,0));
  document.getElementById('res-semana-ped').textContent = weekOrders.length + ' pedidos';

  // This month
  const monthOrders = state.orders.filter(o=>o.status!=='cancelado'&&o.date&&o.date.startsWith(now.toISOString().slice(0,7)));
  document.getElementById('res-mes').textContent = fmt(monthOrders.reduce((s,o)=>s+o.total,0));
  document.getElementById('res-mes-ped').textContent = monthOrders.length + ' pedidos';

  // Top platillos
  const sold = {};
  todayOrders.forEach(o=>o.items.forEach(i=>{sold[i.name]=(sold[i.name]||0)+i.qty;}));
  const sorted = Object.entries(sold).sort((a,b)=>b[1]-a[1]);
  // Compute revenue per product too
  const soldRevenue = {};
  todayOrders.forEach(o=>o.items.forEach(i=>{
    soldRevenue[i.name] = (soldRevenue[i.name]||0) + (i.price * i.qty);
  }));

  if (sorted.length) {
    document.getElementById('res-estrella').textContent = sorted[0][0];
    document.getElementById('res-estrella-sub').textContent = sorted[0][1] + ' vendidos hoy';
    const colors = ['#d9534f','#8a7070','#c0a060','#5a8a5a','#5a70a0'];
    document.getElementById('top-platillos').innerHTML = sorted.slice(0,5).map((e,i)=>`
      <div style="display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border);">
        <div style="width:24px;height:24px;border-radius:50%;background:${colors[i]};color:white;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;">${i+1}</div>
        <div style="flex:1;min-width:0;">
          <div style="font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${e[0]}</div>
          <div style="font-size:11px;color:var(--muted);">${e[1]} vendido${e[1]>1?'s':''}</div>
        </div>
        <div style="font-size:13px;font-weight:700;color:var(--text);white-space:nowrap;">${fmt(soldRevenue[e[0]]||0)}</div>
      </div>`).join('');
  } else {
    document.getElementById('res-estrella').textContent = '-';
    document.getElementById('res-estrella-sub').textContent = '0 vendidos hoy';
    document.getElementById('top-platillos').innerHTML = '<div style="color:var(--muted);font-size:13px;text-align:center;padding:30px 0;">Sin ventas a√∫n</div>';
  }
}

// ========== POS ==========
function renderPOS() {
  const cats = ['Todos', ...new Set(state.products.filter(p=>p.status==='activo').map(p=>p.cat))];
  document.getElementById('cat-tabs').innerHTML = cats.map((c,i)=>`<button class="cat-tab${i===0?' active':''}" onclick="filterCat('${c}',this)">${c}</button>`).join('');
  renderProductGrid('Todos');
}

function renderProductGrid(cat) {
  const search = document.getElementById('pos-search-input').value.toLowerCase();
  const prods = state.products.filter(p => p.status==='activo' && (cat==='Todos'||p.cat===cat) && p.name.toLowerCase().includes(search));
  if (!prods.length) {
    document.getElementById('products-grid').innerHTML = '<div style="color:var(--muted);font-size:14px;padding:20px;">Sin productos</div>';
    return;
  }
  document.getElementById('products-grid').innerHTML = prods.map(p=>`
    <div class="product-card" onclick="addToCart(${p.id})">
      <div class="product-cat-label">${p.cat}</div>
      <div class="product-name">${p.name}</div>
      <div class="product-price">${fmt(p.price)}</div>
    </div>`).join('');
}

let activeCat = 'Todos';
function filterCat(cat, el) {
  activeCat = cat;
  document.querySelectorAll('.cat-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  renderProductGrid(cat);
}
function filterProducts() { renderProductGrid(activeCat); }

function addToCart(id) {
  const p = state.products.find(p=>p.id===id);
  const existing = cart.find(c=>c.id===id);
  if (existing) existing.qty++;
  else cart.push({...p, qty:1});
  updateCartUI();
}

function updateCartUI() {
  const items = document.getElementById('cart-items');
  const empty = document.getElementById('cart-empty');
  if (!cart.length) {
    empty.style.display='flex'; items.innerHTML=''; items.appendChild(empty);
    updateCartTotals(); return;
  }
  const html = cart.map(c=>`
    <div class="cart-item">
      <div class="cart-item-info">
        <div class="cart-item-name">${c.name}</div>
        <div class="cart-item-cat">${c.cat}</div>
        <div class="cart-item-price">${fmt(c.price * c.qty)}</div>
      </div>
      <div class="qty-ctrl">
        <button class="qty-btn" onclick="changeQty(${c.id},-1)">‚àí</button>
        <span class="qty-num">${c.qty}</span>
        <button class="qty-btn" onclick="changeQty(${c.id},1)">+</button>
      </div>
    </div>`).join('');
  items.innerHTML = html;
  updateCartTotals();
}

function changeQty(id, delta) {
  const idx = cart.findIndex(c=>c.id===id);
  if (idx === -1) return;
  cart[idx].qty += delta;
  if (cart[idx].qty <= 0) cart.splice(idx,1);
  updateCartUI();
}

function updateCartTotals() {
  const sub = cart.reduce((s,c)=>s+c.price*c.qty,0);
  const disc = parseFloat(document.getElementById('cart-discount').value)||0;
  const total = Math.max(0, sub-disc);
  document.getElementById('cart-subtotal').textContent = fmt(sub);
  document.getElementById('cart-total').textContent = fmt(total);
  document.getElementById('confirm-total').textContent = fmt(total);
}

function selectPayMethod(m, el) {
  selectedPayMethod = m;
  document.querySelectorAll('.pay-method').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
}

function clearCart() {
  cart = [];
  document.getElementById('cart-client').value = '';
  document.getElementById('cart-discount').value = '0';
  document.getElementById('pago-con').value = '0';
  updateCartUI();
}

let pendingOrderAction = 'confirm'; // 'confirm' or 'save'

function saveOrder() {
  if (!cart.length) { toast('El carrito est√° vac√≠o','error'); return; }
  const clientName = document.getElementById('cart-client').value.trim();
  if (!clientName) {
    pendingOrderAction = 'save';
    document.getElementById('cn-input').value = '';
    openModal('modal-client-name');
  } else {
    doSaveOrder(clientName);
  }
}

function doSaveOrder(clientName) {
  const disc = parseFloat(document.getElementById('cart-discount').value)||0;
  const sub = cart.reduce((s,c)=>s+c.price*c.qty,0);
  const total = Math.max(0,sub-disc);
  const order = {
    id: state.nextOrderId++,
    folio: '#' + String(state.nextOrderId-1).padStart(4,'0'),
    client: clientName || 'Sin nombre',
    items: cart.map(c=>({id:c.id,name:c.name,price:c.price,qty:c.qty,cat:c.cat})),
    subtotal: sub, discount: disc, total,
    payMethod: selectedPayMethod,
    status: 'consumiendo',
    date: today(),
    time: new Date().toLocaleTimeString('es-MX',{hour:'2-digit',minute:'2-digit'}),
  };
  state.orders.push(order);
  updateClientRecord(clientName, total);
  saveState();
  toast('Pedido guardado como "Consumiendo" üçΩÔ∏è');
  clearCart();
}

function confirmOrder() {
  if (!cart.length) { toast('El carrito est√° vac√≠o','error'); return; }
  const clientName = document.getElementById('cart-client').value.trim();
  if (!clientName) {
    pendingOrderAction = 'confirm';
    document.getElementById('cn-input').value = '';
    openModal('modal-client-name');
  } else {
    doConfirmOrder(clientName);
  }
}

function proceedOrder(withName) {
  const name = withName ? document.getElementById('cn-input').value.trim() : '';
  closeModal('modal-client-name');
  if (pendingOrderAction === 'save') {
    doSaveOrder(name || 'Sin nombre');
  } else {
    doConfirmOrder(name || 'Sin nombre');
  }
}

function doConfirmOrder(clientName) {
  const disc = parseFloat(document.getElementById('cart-discount').value)||0;
  const sub = cart.reduce((s,c)=>s+c.price*c.qty,0);
  const total = Math.max(0,sub-disc);
  const pagoCon = parseFloat(document.getElementById('pago-con').value)||0;
  const cambio = pagoCon > total ? pagoCon - total : 0;
  const order = {
    id: state.nextOrderId++,
    folio: '#' + String(state.nextOrderId-1).padStart(4,'0'),
    client: clientName,
    items: cart.map(c=>({id:c.id,name:c.name,price:c.price,qty:c.qty,cat:c.cat})),
    subtotal: sub, discount: disc, total,
    payMethod: selectedPayMethod,
    pagoCon: pagoCon,
    cambio: cambio,
    status: 'pagado',
    date: today(),
    time: new Date().toLocaleTimeString('es-MX',{hour:'2-digit',minute:'2-digit'}),
  };
  state.orders.push(order);
  updateClientRecord(clientName, total);
  saveState();
  showTicket(order);
  clearCart();
}

function updateClientRecord(name, amount) {
  if (!name || name==='Sin nombre') return;
  let cl = state.clients.find(c=>c.name.toLowerCase()===name.toLowerCase());
  if (cl) { cl.visits++; cl.totalSpent+=amount; cl.lastOrder=today(); }
  else { state.clients.push({id:state.nextClientId++,name,phone:'',visits:1,totalSpent:amount,lastOrder:today()}); }
}

function showTicket(order) {
  const payLabels = {efectivo:'Efectivo',tarjeta:'Tarjeta',transferencia:'Transferencia'};
  let html = `<div class="ticket">
    <div class="ticket-center" style="font-weight:bold;font-size:15px;">${state.businessName}</div>
    <div class="ticket-center" style="font-size:11px;color:#666;">Sistema de Ventas</div>
    <hr class="ticket-divider">
    <div class="ticket-row"><span>Folio:</span><span>${order.folio}</span></div>
    <div class="ticket-row"><span>Cliente:</span><span>${order.client}</span></div>
    <div class="ticket-row"><span>Fecha:</span><span>${order.date} ${order.time}</span></div>
    <hr class="ticket-divider">
    ${order.items.map(i=>`<div class="ticket-row"><span>${i.qty}x ${i.name}</span><span>${fmt(i.price*i.qty)}</span></div>`).join('')}
    <hr class="ticket-divider">
    <div class="ticket-row"><span>Subtotal</span><span>${fmt(order.subtotal)}</span></div>
    ${order.discount?`<div class="ticket-row"><span>Descuento</span><span>-${fmt(order.discount)}</span></div>`:''}
    <div class="ticket-row" style="font-weight:bold;font-size:15px;"><span>TOTAL</span><span>${fmt(order.total)}</span></div>
    <hr class="ticket-divider">
    <div class="ticket-row"><span>Pago:</span><span>${payLabels[order.payMethod]||order.payMethod}</span></div>
    ${order.pagoCon>0?`<div class="ticket-row"><span>Pag√≥ con:</span><span>${fmt(order.pagoCon)}</span></div>`:''}
    ${order.cambio>0?`<div class="ticket-row"><span>Cambio:</span><span>${fmt(order.cambio)}</span></div>`:''}
    <hr class="ticket-divider">
    <div class="ticket-center" style="font-size:11px;">¬°Gracias por su visita! üôè</div>
  </div>`;
  document.getElementById('ticket-content').innerHTML = html;
  openModal('modal-ticket');
}

function printTicket() {
  const content = document.getElementById('ticket-content').innerHTML;
  const w = window.open('','_blank','width=400,height=600');
  w.document.write(`<html><head><title>Ticket</title><style>body{font-family:'Courier New',monospace;font-size:13px;padding:20px;}.ticket-row{display:flex;justify-content:space-between;} hr{border:none;border-top:1px dashed #ccc;margin:6px 0;} .ticket-center{text-align:center;}</style></head><body>${content}</body></html>`);
  w.document.close(); w.print();
}

// ========== PRODUCTOS ==========
function renderProductos() {
  const prods = state.products;
  document.getElementById('prod-count-label').textContent = prods.length + ' productos en el men√∫';
  renderProductTable(prods);
}

function renderProductTable(prods) {
  const tbody = document.getElementById('products-table');
  const empty = document.getElementById('prod-empty');
  if (!prods.length) { tbody.innerHTML=''; empty.style.display='flex'; return; }
  empty.style.display='none';
  tbody.innerHTML = prods.map(p=>`
    <tr>
      <td style="font-weight:600;">${p.name}</td>
      <td><span class="badge badge-blue">${p.cat}</span></td>
      <td style="font-family:'Young Serif',serif;color:var(--primary);">${fmt(p.price)}</td>
      <td><span class="badge ${p.status==='activo'?'badge-green':'badge-red'}">${p.status==='activo'?'Activo':'Inactivo'}</span></td>
      <td>
        <button class="btn btn-outline btn-sm" onclick="editProduct(${p.id})" style="margin-right:6px;">‚úèÔ∏è Editar</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(${p.id})">üóë</button>
      </td>
    </tr>`).join('');
}

function filterProductTable(q) {
  const filtered = state.products.filter(p=>p.name.toLowerCase().includes(q.toLowerCase()));
  renderProductTable(filtered);
}

function openProductModal(id) {
  document.getElementById('edit-prod-id').value = '';
  document.getElementById('prod-name').value = '';
  document.getElementById('prod-price').value = '';
  document.getElementById('prod-cat').value = 'Plato';
  document.getElementById('prod-status').value = 'activo';
  document.getElementById('modal-prod-title').textContent = 'Agregar Producto';
  openModal('modal-product');
}

function editProduct(id) {
  const p = state.products.find(p=>p.id===id);
  document.getElementById('edit-prod-id').value = id;
  document.getElementById('prod-name').value = p.name;
  document.getElementById('prod-price').value = p.price;
  document.getElementById('prod-cat').value = p.cat;
  document.getElementById('prod-status').value = p.status;
  document.getElementById('modal-prod-title').textContent = 'Editar Producto';
  openModal('modal-product');
}

function saveProduct() {
  const name = document.getElementById('prod-name').value.trim();
  const price = parseFloat(document.getElementById('prod-price').value);
  const cat = document.getElementById('prod-cat').value;
  const status = document.getElementById('prod-status').value;
  const editId = document.getElementById('edit-prod-id').value;
  if (!name||isNaN(price)||price<0) { toast('Completa los campos requeridos','error'); return; }
  if (editId) {
    const p = state.products.find(p=>p.id===parseInt(editId));
    p.name=name; p.price=price; p.cat=cat; p.status=status;
    toast('Producto actualizado');
  } else {
    state.products.push({id:state.nextProductId++,name,price,cat,status});
    toast('Producto agregado');
  }
  saveState();
  closeModal('modal-product');
  renderProductos();
}

function deleteProduct(id) {
  state.products = state.products.filter(p=>p.id!==id);
  saveState(); renderProductos();
  toast('Producto eliminado');
}

// ========== CLIENTES ==========
function renderClientes() {
  const cls = state.clients;
  document.getElementById('client-count-label').textContent = cls.length + ' clientes registrados';
  document.getElementById('cl-total').textContent = cls.length;
  const frecuentes = cls.filter(c=>c.visits>=3).length;
  document.getElementById('cl-frecuentes').textContent = frecuentes;
  const maxVisits = cls.reduce((m,c)=>Math.max(m,c.visits),0);
  document.getElementById('cl-visitas').textContent = maxVisits;
  const totalGastado = cls.reduce((s,c)=>s+c.totalSpent,0);
  document.getElementById('cl-gastado').textContent = fmt(totalGastado);
  renderClientsTable(cls);
}

function renderClientsTable(cls) {
  const tbody = document.getElementById('clients-table');
  const empty = document.getElementById('cl-empty');
  if (!cls.length) { tbody.innerHTML=''; empty.style.display='flex'; return; }
  empty.style.display='none';
  tbody.innerHTML = cls.map(c=>`
    <tr>
      <td style="font-weight:600;">${c.name}${c.visits>=3?` <span class="badge badge-yellow">‚≠ê Frecuente</span>`:''}</td>
      <td>${c.visits}</td>
      <td>${c.lastOrder||'-'}</td>
      <td style="font-family:'Young Serif',serif;color:var(--primary);">${fmt(c.totalSpent)}</td>
    </tr>`).join('');
}

function filterClients(q) {
  const filtered = state.clients.filter(c=>c.name.toLowerCase().includes(q.toLowerCase()));
  renderClientsTable(filtered);
}

function openClientModal() {
  document.getElementById('cl-name').value='';
  document.getElementById('cl-phone').value='';
  openModal('modal-client');
}

function saveClient() {
  const name = document.getElementById('cl-name').value.trim();
  if (!name) { toast('El nombre es requerido','error'); return; }
  const existing = state.clients.find(c=>c.name.toLowerCase()===name.toLowerCase());
  if (existing) { toast('Este cliente ya existe','error'); return; }
  state.clients.push({id:state.nextClientId++,name,phone:document.getElementById('cl-phone').value,visits:0,totalSpent:0,lastOrder:null});
  saveState(); closeModal('modal-client'); renderClientes();
  toast('Cliente registrado');
}

// ========== HISTORIAL ==========
function renderHistorial() {
  const count = state.orders.length;
  document.getElementById('hist-count-label').textContent = count + ' pedidos registrados';
  applyHistFilter();
}

function setHistFilter(f, el) {
  histFilter = f;
  document.querySelectorAll('.filter-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  applyHistFilter();
}

function filterHistorial(q) {
  histSearch = q;
  applyHistFilter();
}

function applyHistFilter() {
  let orders = [...state.orders];
  if (histFilter !== 'todos') orders = orders.filter(o=>o.status===histFilter);
  if (histSearch) orders = orders.filter(o=>o.client.toLowerCase().includes(histSearch.toLowerCase())||o.folio.toLowerCase().includes(histSearch.toLowerCase()));
  orders.reverse();
  renderHistorialTable(orders);
}

const statusBadge = {pagado:'badge-green',consumiendo:'badge-yellow',cancelado:'badge-red'};
const statusLabel = {pagado:'Pagado',consumiendo:'Consumiendo',cancelado:'Cancelado'};
const payLabel = {efectivo:'Efectivo',tarjeta:'Tarjeta',transferencia:'Transfer'};

function renderHistorialTable(orders) {
  const container = document.getElementById('historial-cards');
  const empty = document.getElementById('hist-empty');
  if (!orders.length) { container.innerHTML=''; empty.style.display='flex'; return; }
  empty.style.display='none';
  const payLabels = {efectivo:'Efectivo',tarjeta:'Tarjeta',transferencia:'Transferencia'};
  container.innerHTML = orders.map(o=>`
    <div class="hist-card" id="hcard-${o.id}">
      <div class="hist-card-header" onclick="toggleHistCard(${o.id})">
        <div class="hist-card-icon">üßæ</div>
        <div>
          <div style="display:flex;align-items:center;gap:8px;">
            <span class="hist-card-folio">${o.folio}</span>
            <span class="badge ${statusBadge[o.status]}">${statusLabel[o.status]}</span>
          </div>
          <div class="hist-card-client">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            ${o.client}
            <span style="margin-left:6px;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
            </span>
            ${o.date}, ${o.time}
          </div>
        </div>
        <div class="hist-card-right">
          <div>
            <div class="hist-card-total">${fmt(o.total)}</div>
            <div class="hist-card-pay">${payLabels[o.payMethod]||o.payMethod}</div>
          </div>
          <span class="hist-card-chevron">‚ñæ</span>
        </div>
      </div>
      <div class="hist-card-body">
        <div class="hist-items-label">Productos</div>
        ${o.items.map(i=>`
          <div class="hist-item-row">
            <span>${i.name} x${i.qty}</span>
            <span>${fmt(i.price*i.qty)}</span>
          </div>`).join('')}
        <div class="hist-totals">
          <div class="hist-total-row"><span>Subtotal</span><span>${fmt(o.subtotal)}</span></div>
          ${o.discount?`<div class="hist-total-row"><span>Descuento</span><span>-${fmt(o.discount)}</span></div>`:''}
          <div class="hist-total-row main"><span>Total</span><span>${fmt(o.total)}</span></div>
        </div>
        ${o.status !== 'cancelado' ? `
        <div class="hist-actions">
          ${o.status==='consumiendo'?`<button class="btn-cobrar" onclick="cobrarFromCard(${o.id})">üíµ Cobrar</button>`:`<button class="btn-cobrar" onclick="showTicketById(${o.id})">üßæ Ver Ticket</button>`}
          <button class="btn-eliminar" onclick="eliminarPedido(${o.id})">üóë Eliminar</button>
        </div>` : `
        <div class="hist-actions">
          <button class="btn-eliminar" style="flex:1;justify-content:center;" onclick="eliminarPedido(${o.id})">üóë Eliminar</button>
        </div>`}
      </div>
    </div>`).join('');
}

function toggleHistCard(id) {
  const card = document.getElementById('hcard-'+id);
  card.classList.toggle('open');
}

function cobrarFromCard(id) {
  const o = state.orders.find(o=>o.id===id);
  if (o) { o.status='pagado'; saveState(); showTicket(o); applyHistFilter(); toast('‚úÖ Pedido cobrado'); }
}

function eliminarPedido(id) {
  state.orders = state.orders.filter(o=>o.id!==id);
  saveState(); applyHistFilter(); renderHistorial();
  toast('Pedido eliminado');
}

function viewOrder(id) {
  viewingOrderId = id;
  const o = state.orders.find(o=>o.id===id);
  const payLabels = {efectivo:'Efectivo',tarjeta:'Tarjeta',transferencia:'Transferencia'};
  document.getElementById('order-detail-content').innerHTML = `
    <div style="margin-bottom:16px;">
      <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
        <span style="font-weight:700;color:var(--primary);">${o.folio}</span>
        <span class="badge ${statusBadge[o.status]}">${statusLabel[o.status]}</span>
      </div>
      <div style="font-size:13px;color:var(--muted);">Cliente: <strong>${o.client}</strong> ¬∑ ${o.date} ${o.time}</div>
    </div>
    <table style="width:100%;font-size:14px;margin-bottom:14px;">
      <thead><tr><th style="text-align:left;padding:6px 0;color:var(--muted);font-size:12px;">Platillo</th><th style="text-align:right;padding:6px 0;color:var(--muted);font-size:12px;">Cant.</th><th style="text-align:right;padding:6px 0;color:var(--muted);font-size:12px;">Precio</th></tr></thead>
      <tbody>${o.items.map(i=>`<tr><td style="padding:6px 0;">${i.name}</td><td style="text-align:right;">${i.qty}</td><td style="text-align:right;">${fmt(i.price*i.qty)}</td></tr>`).join('')}</tbody>
    </table>
    ${o.discount?`<div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:4px;"><span>Descuento</span><span>-${fmt(o.discount)}</span></div>`:''}
    <div style="display:flex;justify-content:space-between;font-size:16px;font-weight:700;border-top:1px solid var(--border);padding-top:10px;margin-bottom:10px;"><span>Total</span><span style="color:var(--primary);">${fmt(o.total)}</span></div>
    <div style="font-size:13px;color:var(--muted);">M√©todo de pago: <strong>${payLabels[o.payMethod]||o.payMethod}</strong></div>
    ${o.status==='consumiendo'?`<div style="margin-top:12px;display:flex;gap:8px;"><button class="btn btn-secondary btn-sm" onclick="markAsPaid(${o.id})">‚úÖ Marcar como Pagado</button></div>`:''}
  `;
  const cancelBtn = document.getElementById('cancel-order-btn');
  cancelBtn.style.display = o.status==='cancelado' ? 'none' : 'inline-flex';
  openModal('modal-order');
}

function markAsPaid(id) {
  const o = state.orders.find(o=>o.id===id);
  if (o) { o.status='pagado'; saveState(); closeModal('modal-order'); renderHistorial(); toast('Pedido marcado como pagado'); }
}

function cancelCurrentOrder() {
  const o = state.orders.find(o=>o.id===viewingOrderId);
  if (o) { o.status='cancelado'; saveState(); closeModal('modal-order'); renderHistorial(); toast('Pedido cancelado'); }
}

function showTicketById(id) {
  const o = state.orders.find(o=>o.id===id);
  if (o) showTicket(o);
}

// ========== AJUSTES ==========
function renderAjustes() {
  document.getElementById('settings-nombre').value = state.businessName;
  refreshCorte();
}

function refreshCorte() {
  const todayOrders = state.orders.filter(o=>o.date===today()&&o.status!=='cancelado');
  const total = todayOrders.reduce((s,o)=>s+o.total,0);
  const tickets = todayOrders.length;
  const prom = tickets ? Math.round(total/tickets) : 0;
  const efectivo = todayOrders.filter(o=>o.payMethod==='efectivo').reduce((s,o)=>s+o.total,0);
  const tarjeta = todayOrders.filter(o=>o.payMethod==='tarjeta').reduce((s,o)=>s+o.total,0);
  const transfer = todayOrders.filter(o=>o.payMethod==='transferencia').reduce((s,o)=>s+o.total,0);
  document.getElementById('corte-total').textContent = fmt(total);
  document.getElementById('corte-tickets').textContent = tickets;
  document.getElementById('corte-prom').textContent = fmt(prom);
  document.getElementById('corte-efectivo').textContent = fmt(efectivo);
  document.getElementById('corte-tarjeta').textContent = fmt(tarjeta);
  document.getElementById('corte-transfer').textContent = fmt(transfer);
  const pendientes = state.orders.filter(o=>o.date===today()&&o.status==='consumiendo').length;
  document.getElementById('corte-corriente').innerHTML = pendientes > 0
    ? `‚è≥ <strong>${pendientes}</strong> pedido(s) pendiente(s) de cobro`
    : '‚úÖ Todo al Corriente ‚Äî Todas las cuentas han sido cobradas';
  document.getElementById('corte-corriente').style.background = pendientes > 0 ? '#fef8e1' : '#e8f5ee';
  document.getElementById('corte-corriente').style.color = pendientes > 0 ? '#a07800' : '#2d6a4f';
}

function saveBusinessName() {
  const name = document.getElementById('settings-nombre').value.trim();
  if (!name) { toast('El nombre no puede estar vac√≠o','error'); return; }
  state.businessName = name;
  document.getElementById('brand-name-display').textContent = name;
  document.getElementById('about-name').textContent = name;
  saveState(); toast('Nombre actualizado');
}

let dangerType = null;
function confirmDanger(type) {
  dangerType = type;
  if (type==='historial') {
    document.getElementById('danger-title').textContent = '¬øEliminar historial?';
    document.getElementById('danger-sub').textContent = 'Se borrar√°n todas las ventas y clientes. Los productos se mantienen.';
  } else {
    document.getElementById('danger-title').textContent = '¬øReiniciar todo?';
    document.getElementById('danger-sub').textContent = 'TODOS los datos ser√°n eliminados: productos, clientes, ventas. Acci√≥n irreversible.';
  }
  openModal('modal-danger');
}

function executeDanger() {
  if (dangerType==='historial') {
    state.orders=[]; state.clients=[]; state.nextOrderId=1; state.nextClientId=1;
    toast('Historial eliminado');
  } else {
    state = { businessName: state.businessName, products:[], orders:[], clients:[], nextOrderId:1, nextProductId:1, nextClientId:1 };
    toast('Sistema reiniciado');
  }
  saveState(); closeModal('modal-danger'); renderAjustes();
}

// ========== INIT ==========
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('res-date').textContent = todayStr();
  document.getElementById('brand-name-display').textContent = state.businessName;
  document.getElementById('about-name').textContent = state.businessName;
  renderResumen();
  // Close modals on overlay click
  document.querySelectorAll('.modal-overlay').forEach(m=>{
    m.addEventListener('click', e => { if(e.target===m) m.classList.remove('open'); });
  });
});
</script>


</body></html>
